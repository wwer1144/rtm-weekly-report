<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>RTM ì£¼ê°„ í•™ìŠµ ë³´ê³ ì„œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg: #f5f7ff;
      --card-bg: #ffffff;
      --text-main: #0f172a;
      --text-sub: #4b5563;
      --border: #d4d4dd;

      --sky: #e0f2ff;
      --sky-border: #bfdbfe;
      --primary: #0ea5e9;
      --secondary: #6366f1;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; }
    html { scroll-behavior: smooth; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background:
        radial-gradient(circle at top, rgba(59,130,246,0.18), transparent 60%),
        var(--bg);
      color: var(--text-main);
      line-height: 1.6;
      overflow-x: hidden;
    }

    a { text-decoration: none; color: inherit; }

    .page {
      max-width: 1024px;
      margin: 0 auto;
      padding: 26px 18px 60px;
      position: relative;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .logo {
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--primary);
    }

    /* â­ ëª¨ë°”ì¼ ìµœì í™” ìƒë‹¨ ê³ ì • í—¤ë” */
    .sticky-header {
      position: sticky;
      top: 0;
      background: #f5f7ff;
      padding: 10px 6px;
      z-index: 999;
      border-bottom: 1px solid #d1d5db;
      font-size: 13px;
      color: #334155;
      font-weight: 600;
      display: none;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    .badge {
      display: inline-block;
      font-size: 11px;
      padding: 6px 18px;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(14,165,233,0.1), rgba(99,102,241,0.12));
      color: var(--primary);
      margin-bottom: 10px;
      font-weight: 600;
      letter-spacing: 0.12em;
      border: 1px solid rgba(148,163,184,0.8);
    }

    h1 {
      font-size: 26px;
      margin-bottom: 6px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: #020617;
    }

    .slogan-main {
      font-size: 14px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.26em;
      color: var(--secondary);
    }

    header p {
      font-size: 14px;
      color: var(--text-sub);
    }

    .meta-line {
      margin-top: 10px;
      font-size: 13px;
      color: var(--text-sub);
    }

    .section {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px 20px 18px;
      margin-bottom: 20px;
      border: 1px solid var(--border);
      box-shadow: 0 10px 24px rgba(15,23,42,0.06);
    }

    .section h2 {
      font-size: 18px;
      margin-bottom: 8px;
      color: #020617;
    }

    .section p {
      font-size: 14px;
      color: var(--text-sub);
    }

    /************ ğŸ“± ëª¨ë°”ì¼ ìµœì í™” ************/
    @media (max-width: 480px) {
      h1 { font-size: 22px; }
      h2 { font-size: 17px; }
      .section { padding: 16px 14px; margin-bottom: 16px; }
      .page { padding: 18px 12px 40px; }
      .badge { font-size: 10px; padding: 5px 14px; }
      .slogan-main { font-size: 12px; letter-spacing: 0.15em; }
      p, li { font-size: 13px; line-height: 1.55; }
      .sticky-header { display: block; }
    }

    .hidden { display: none; }

    /************ ğŸ“± í„°ì¹˜ UX í–¥ìƒ ë²„íŠ¼ ************/
    .btn {
      padding: 12px 18px;
      border-radius: 10px;
      background: var(--sky);
      border: 1px solid var(--sky-border);
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      margin-top: 10px;
    }

    /************ ğŸ“± ì•„ì½”ë””ì–¸ ************/
    .accordion-toggle {
      font-size: 14px;
      color: #0ea5e9;
      cursor: pointer;
      margin-top: 6px;
    }
    .accordion-content {
      display: none;
      margin-top: 8px;
    }

    /************ ğŸ“± ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© ************/
    .skeleton {
      background: #e2e8f0;
      height: 16px;
      width: 100%;
      border-radius: 6px;
      margin-bottom: 6px;
      animation: pulse 1.4s infinite ease-in-out;
    }

    @keyframes pulse {
      0% { opacity: .6; }
      50% { opacity: 1; }
      100% { opacity: .6; }
    }

    footer {
      margin-top: 22px;
      text-align: center;
      font-size: 11px;
      color: #6b7280;
    }
  </style>
</head>

<body>
  <div class="sticky-header" id="sticky-info"></div>

  <div class="page">
    <div class="topbar">
      <div class="logo">RTM MATH LAB</div>
    </div>

    <header>
      <div class="badge">WEEKLY PERFORMANCE REPORT</div>
      <h1>ì£¼ê°„ í•™ìŠµ ë³´ê³ ì„œ</h1>
      <div class="slogan-main">RACE TO MIRACLE</div>
      <p>í•œ ì£¼ ë™ì•ˆì˜ ìˆ˜ì—… ë‚´ìš©ì„ ì •í™•í•˜ê²Œ ì •ë¦¬í•œ ë¦¬í¬íŠ¸ì…ë‹ˆë‹¤.</p>
      <div class="meta-line" id="meta-line"></div>
    </header>

    <!-- ìŠ¤ì¼ˆë ˆí†¤ -->
    <div id="skeleton" class="hidden">
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton" style="width:70%;"></div>
    </div>

    <div id="status" class="status"></div>

    <!-- í•™ìƒ ì„ íƒ ì „ -->
    <div id="selector-view">
      <section class="section">
        <h2>ğŸ” ì ‘ì† ì¸ì¦</h2>
        <input id="pin-input" type="password" maxlength="10" placeholder="4ìë¦¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
        <button class="btn" id="pin-btn">í™•ì¸</button>
        <div id="pin-msg" class="status"></div>
      </section>

      <section class="section hidden" id="student-select-section">
        <h2>ğŸ‘¨â€ğŸ“ í•™ìƒ ì„ íƒ</h2>
        <select id="student-select">
          <option value="">í•™ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”</option>
        </select>
        <button class="btn" id="go-report-btn">ë³´ê³ ì„œ ì—´ê¸°</button>
      </section>
    </div>

    <!-- í•™ìƒ ë³´ê³ ì„œ -->
    <div id="report-view" class="hidden">

      <section class="section r-section">
        <h2>ğŸ•’ 1. ì¶œê²° í˜„í™©</h2>
        <div class="accordion-content"><p id="attendance"></p></div>
      </section>

      <section class="section r-section">
        <h2>ğŸ“š 2. ë‹¨ì›ë³„ ì§„ë„</h2>
        <div class="accordion-content"><p id="progress"></p></div>
      </section>

      <section class="section r-section">
        <h2>âœï¸ 3. ìˆ™ì œ ìˆ˜í–‰ë¥ </h2>
        <div class="accordion-content"><p id="homework"></p></div>
      </section>

      <section class="section r-section">
        <h2>ğŸ“Š 4. í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div class="accordion-content"><p id="test"></p></div>
      </section>

      <section class="section r-section">
        <h2>ğŸ§‘â€ğŸ« 5. ë‹´ì„ ì¢…í•© ì½”ë©˜íŠ¸</h2>
        <div class="accordion-content">
          <p id="comment-summary"></p>
          <p id="comment-good"></p>
          <p id="comment-need"></p>
          <p id="comment-plan"></p>
        </div>
      </section>
    </div>

    <footer>
      RTM ì£¼ê°„ ë³´ê³ ì„œ Â© All rights reserved.
    </footer>
  </div>

<script>
  // ê°„ë‹¨ ì ê¸ˆìš© PIN
  const ACCESS_PIN = "4925";

  const selectorView = document.getElementById('selector-view');
  const reportView   = document.getElementById('report-view');
  const statusEl     = document.getElementById('status');
  const metaLine     = document.getElementById('meta-line');
  const stickyInfo   = document.getElementById('sticky-info');

  const pinInput = document.getElementById('pin-input');
  const pinBtn   = document.getElementById('pin-btn');
  const pinMsg   = document.getElementById('pin-msg');
  const studentSelectSection = document.getElementById('student-select-section');
  const studentSelect = document.getElementById('student-select');
  const goReportBtn   = document.getElementById('go-report-btn');

  const skeleton = document.getElementById('skeleton');

  function showSelector() {
    selectorView.classList.remove('hidden');
    reportView.classList.add('hidden');
    stickyInfo.style.display = "none";
    metaLine.textContent = 'í•™ìƒì„ ì„ íƒí•˜ì‹œë©´ í•´ë‹¹ í•™ìƒì˜ ì£¼ê°„ í•™ìŠµ ë³´ê³ ì„œë¥¼ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
  }

  function showReport() {
    selectorView.classList.add('hidden');
    reportView.classList.remove('hidden');
    stickyInfo.style.display = "block";
  }

  function getStudentIdFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get('student');
  }

  // í•™ìƒ ëª©ë¡ ë¡œë”©
  async function loadStudentList() {
    try {
      const res = await fetch('data/students.json');
      if (!res.ok) return;
      const list = await res.json();

      studentSelect.innerHTML = '<option value="">í•™ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”</option>';

      list.forEach(s => {
        const opt = document.createElement('option');
        opt.value = s.id;
        opt.textContent = `${s.grade} ${s.name}`;
        studentSelect.appendChild(opt);
      });
    } catch (e) {
      console.error(e);
    }
  }

  // JSON ì•ˆì „ ì ‘ê·¼
  const safe = (v) => (v === undefined || v === null ? '' : v);

  // ë³´ê³ ì„œ ë¡œë”©
  async function loadReport(studentId) {
    statusEl.textContent = 'ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...';
    skeleton.classList.remove('hidden');
    reportView.classList.add('hidden');

    try {
      const res = await fetch(`data/${studentId}.json`);
      if (!res.ok) {
        statusEl.textContent = `í•´ë‹¹ í•™ìƒ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (data/${studentId}.json)`;
        showSelector();
        skeleton.classList.add('hidden');
        return;
      }

      const data = await res.json();
      statusEl.textContent = '';

      // ìƒë‹¨ ì •ë³´
      metaLine.textContent =
        `${safe(data.week)} Â· ${safe(data.grade)} ${safe(data.studentName)} í•™ìƒ Â· ê³¼ëª©: ${safe(data.subject)}`;

      stickyInfo.textContent =
        `${safe(data.studentName)} í•™ìƒ Â· ${safe(data.week)}`;

      // ì¶œê²°
      const att = data.attendance || {};
      document.getElementById('attendance').innerHTML =
        `Â· ì´ë²ˆ ì£¼ ìˆ˜ì—…ì¼: ${safe(att.totalClasses)}<br/>
         Â· ê²°ì„ ${safe(att.absent)}íšŒ / ì§€ê° ${safe(att.late)}íšŒ / ì¡°í‡´ ${safe(att.earlyLeave)}íšŒ<br/>
         Â· ìˆ˜ì—… íƒœë„: ${safe(att.attitude)}`;

      // ì§„ë„
      const prog = data.progress || {};
      document.getElementById('progress').innerHTML =
        `Â· í•™ìŠµ ë‹¨ì›: ${safe(prog.unit)}<br/>
         Â· ìƒì„¸ ì§„ë„: ${safe(prog.detail)}<br/>
         Â· ì´í•´ë„: ${safe(prog.understanding)}`;

      // ìˆ™ì œ
      const hw = data.homework || {};
      document.getElementById('homework').innerHTML =
        `Â· ìˆ™ì œ ë¶„ëŸ‰: ${safe(hw.amount)}<br/>
         Â· ì œì¶œ ì—¬ë¶€: ${safe(hw.submission)}<br/>
         Â· ìˆ˜í–‰ë¥ : ${safe(hw.completion)}<br/>
         Â· ì •ë‹µë¥ : ${safe(hw.correct)}<br/>
         Â· ì½”ë©˜íŠ¸: ${safe(hw.comment)}`;

      // í…ŒìŠ¤íŠ¸
      const test = data.test || {};
      document.getElementById('test').innerHTML =
        `Â· í…ŒìŠ¤íŠ¸ ì¢…ë¥˜: ${safe(test.type)}<br/>
         Â· ì‹œí—˜ ì¼ì: ${safe(test.date)}<br/>
         Â· ì ìˆ˜: ${safe(test.score)}ì  / ${safe(test.total)}ì  (ë°˜ í‰ê·  ${safe(test.classAverage)}ì )<br/>
         Â· ìƒëŒ€ ìœ„ì¹˜: ${safe(test.rank)}<br/>
         Â· í•´ì„: ${safe(test.analysis)}`;

      // ì½”ë©˜íŠ¸
      const com = data.comment || {};
      document.getElementById('comment-summary').textContent = safe(com.summary);
      document.getElementById('comment-good').textContent    = `â‘  ì˜í•œ ì : ${safe(com.good)}`;
      document.getElementById('comment-need').textContent    = `â‘¡ ë³´ì™„ì´ í•„ìš”í•œ ë¶€ë¶„: ${safe(com.need)}`;
      document.getElementById('comment-plan').textContent    = `â‘¢ ë‹¤ìŒ ì£¼ ì§€ë„ ê³„íš: ${safe(com.plan)}`;

      skeleton.classList.add('hidden');
      showReport();

      // ì•„ì½”ë””ì–¸ ê¸°ëŠ¥ ìƒì„±
      setupAccordion();

    } catch (e) {
      console.error(e);
      statusEl.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
      skeleton.classList.add('hidden');
    }
  }

  // ì•„ì½”ë””ì–¸ ê¸°ëŠ¥
  function setupAccordion() {
    document.querySelectorAll('.r-section').forEach(sec => {
      const title = sec.querySelector('h2');
      const content = sec.querySelector('.accordion-content');

      if (!title || !content) return;

      // í† ê¸€ ë²„íŠ¼ ìƒì„±
      const toggle = document.createElement('div');
      toggle.className = 'accordion-toggle';
      toggle.textContent = 'ë‚´ìš© ë³´ê¸° â–¼';

      // ë§¨ ì•„ë˜ì— ì‚½ì…
      sec.insertBefore(toggle, content);

      toggle.addEventListener('click', () => {
        const open = content.style.display === 'block';
        content.style.display = open ? 'none' : 'block';
        toggle.textContent = open ? 'ë‚´ìš© ë³´ê¸° â–¼' : 'ì ‘ê¸° â–²';
      });
    });
  }

  // PIN í™•ì¸
  pinBtn.addEventListener('click', () => {
    const v = pinInput.value.trim();
    if (v === ACCESS_PIN) {
      localStorage.setItem('rtmWeeklyAuthorized', '1');
      pinMsg.textContent = '';
      studentSelectSection.classList.remove('hidden');
      loadStudentList();
    } else {
      pinMsg.textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
    }
  });

  // í•™ìƒ ì„ íƒ í›„ ì´ë™
  goReportBtn.addEventListener('click', () => {
    const id = studentSelect.value;
    if (!id) return;
    window.location.href = `./?student=${encodeURIComponent(id)}`;
  });

  // ì´ˆê¸° ì§„ì…
  (function init() {
    const studentId = getStudentIdFromUrl();
    const authorized = localStorage.getItem('rtmWeeklyAuthorized') === '1';

    if (studentId) {
      loadReport(studentId);
    } else {
      showSelector();
      if (authorized) {
        studentSelectSection.classList.remove('hidden');
        loadStudentList();
      }
    }
  })();
</script>

</body>
</html>
