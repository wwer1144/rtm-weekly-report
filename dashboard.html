<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RTM í•™ìƒ ëŒ€ì‹œë³´ë“œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg: #f5f7ff;
      --card-bg: #ffffff;
      --text-main: #0f172a;
      --text-sub: #4b5563;
      --border: #d4d4dd;

      --sky: #e0f2ff;
      --sky-border: #bfdbfe;
      --primary: #0ea5e9;
      --secondary: #6366f1;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      padding: 20px;
      color: var(--text-main);
    }

    h1 {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 20px;
      text-align: center;
    }

    .controls {
      display: grid;
      gap: 12px;
      grid-template-columns: 1fr 1fr;
      margin-bottom: 16px;
    }

    @media (max-width: 600px) {
      .controls {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px;
      border: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      margin-bottom: 12px;
    }

    .student-name {
      font-size: 18px;
      font-weight: 700;
      color: var(--secondary);
    }

    .student-info {
      margin-top: 6px;
      font-size: 14px;
      color: var(--text-sub);
      line-height: 1.4;
    }

    .btn-small {
      padding: 6px 10px;
      border-radius: 8px;
      background: var(--sky);
      border: 1px solid var(--sky-border);
      font-size: 13px;
      cursor: pointer;
      margin-top: 10px;
    }

    .btn-small:hover {
      background: #bae6fd;
    }

    /* ê²€ìƒ‰ì°½ / ì •ë ¬ / í•„í„° */
    input, select {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      font-size: 14px;
      width: 100%;
    }

    .list {
      margin-top: 20px;
    }

    /* ê·¸ë˜í”„ ëª¨ë‹¬ */
    .modal-bg {
      position: fixed;
      left:0; right:0; top:0; bottom:0;
      background: rgba(0,0,0,0.4);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .modal {
      background: #fff;
      padding: 20px;
      border-radius: 14px;
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    #modal-close {
      margin-top: 12px;
      padding: 8px 16px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<h1>RTM ì „ì²´ í•™ìƒ ëŒ€ì‹œë³´ë“œ</h1>

<div class="controls">
  <input id="search" type="text" placeholder="í•™ìƒ ì´ë¦„ / í•™ë…„ ê²€ìƒ‰â€¦">

  <select id="filter-grade">
    <option value="">ì „ì²´ í•™ë…„</option>
    <option value="ì´ˆ">ì´ˆë“±</option>
    <option value="ì¤‘">ì¤‘ë“±</option>
    <option value="ê³ ">ê³ ë“±</option>
  </select>

  <select id="sort">
    <option value="">ì •ë ¬ ì—†ìŒ</option>
    <option value="name">ì´ë¦„ìˆœ</option>
    <option value="grade">í•™ë…„ìˆœ</option>
    <option value="homework">ìˆ™ì œ ìˆ˜í–‰ë¥ ìˆœ</option>
    <option value="test">í…ŒìŠ¤íŠ¸ ì ìˆ˜ìˆœ</option>
  </select>

  <button id="monthly-btn" class="btn-small">ğŸ“… ì›”ê°„ ë¦¬í¬íŠ¸ ìë™ ìƒì„±</button>
</div>

<div id="student-list" class="list"></div>

<!-- ì¶œê²° ê·¸ë˜í”„ ëª¨ë‹¬ -->
<div id="modal-bg" class="modal-bg">
  <div class="modal">
    <h3 id="modal-title">ì¶œê²° ê·¸ë˜í”„</h3>
    <canvas id="attendanceChart" width="300" height="200"></canvas>
    <button id="modal-close">ë‹«ê¸°</button>
  </div>
</div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
let students = [];

// JSON ë¡œë“œ
async function loadStudents() {
  try {
    const res = await fetch("data/students.json");
    students = await res.json();
    renderList(students);
  } catch (e) {
    console.error("í•™ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", e);
  }
}

// í•™ìƒ ì¹´ë“œ HTML ìƒì„±
function createStudentCard(s) {
  return `
    <div class="card">
      <div class="student-name">${s.name} (${s.grade})</div>
      <div class="student-info">
        Â· ìˆ™ì œ ìˆ˜í–‰ë¥ : ${s.homework || "??"}<br>
        Â· í…ŒìŠ¤íŠ¸ ì ìˆ˜: ${s.test || "??"}<br>
        Â· ê²°ì„ ${s.att?.absent ?? 0} Â· ì§€ê° ${s.att?.late ?? 0} Â· ì¡°í‡´ ${s.att?.earlyLeave ?? 0}
      </div>
      <button class="btn-small" onclick="openAttendance('${s.id}')">ğŸ“Š ì¶œê²° ê·¸ë˜í”„</button>
      <a href="./?student=${s.id}">
        <button class="btn-small">ğŸ“„ ë³´ê³ ì„œ ë³´ê¸°</button>
      </a>
    </div>
  `;
}

// ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
function renderList(list) {
  const box = document.getElementById("student-list");
  box.innerHTML = list.map(createStudentCard).join("");
}

// ê²€ìƒ‰ ê¸°ëŠ¥
document.getElementById("search").addEventListener("input", () => {
  const q = document.getElementById("search").value.trim();
  filterAndRender(q);
});

// í•„í„° + ì •ë ¬ ì ìš©
function filterAndRender(q = "") {
  let filtered = [...students];

  // ê²€ìƒ‰
  if (q) {
    filtered = filtered.filter(s =>
      s.name.includes(q) ||
      s.grade.includes(q) ||
      s.id.includes(q)
    );
  }

  // í•™ë…„ í•„í„°
  const fg = document.getElementById("filter-grade").value;
  if (fg) {
    filtered = filtered.filter(s => s.grade.startsWith(fg));
  }

  // ì •ë ¬
  const sortType = document.getElementById("sort").value;
  switch (sortType) {
    case "name":
      filtered.sort((a,b)=>a.name.localeCompare(b.name));
      break;
    case "grade":
      filtered.sort((a,b)=>a.grade.localeCompare(b.grade));
      break;
    case "homework":
      filtered.sort((a,b)=>(parseInt(b.homework)-parseInt(a.homework)));
      break;
    case "test":
      filtered.sort((a,b)=>(parseInt(b.test)-parseInt(a.test)));
      break;
  }

  renderList(filtered);
}

// ì •ë ¬ ë° í•„í„° ì´ë²¤íŠ¸ ë“±ë¡
document.getElementById("filter-grade").addEventListener("change", filterAndRender);
document.getElementById("sort").addEventListener("change", filterAndRender);

// ì¶œê²° ê·¸ë˜í”„
let chart;

function openAttendance(id) {
  const s = students.find(x => x.id === id);
  if (!s) return;

  document.getElementById("modal-bg").style.display = "flex";
  document.getElementById("modal-title").textContent = `${s.name} ì¶œê²° ê·¸ë˜í”„`;

  const ctx = document.getElementById("attendanceChart");

  if (chart) chart.destroy();

  chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['ê²°ì„', 'ì§€ê°', 'ì¡°í‡´'],
      datasets: [{
        label: "íšŸìˆ˜",
        data: [
          s.att?.absent ?? 0,
          s.att?.late ?? 0,
          s.att?.earlyLeave ?? 0
        ],
        backgroundColor: ['#f87171', '#facc15', '#60a5fa']
      }]
    }
  });
}

document.getElementById("modal-close").onclick = () => {
  document.getElementById("modal-bg").style.display = "none";
};


// âš¡ ì›”ê°„ ë¦¬í¬íŠ¸ ìƒì„±
document.getElementById("monthly-btn").onclick = () => {
  let msg = "ğŸ“… ì´ë²ˆ ë‹¬ ìš”ì•½\n\n";

  students.forEach(s => {
    msg += `ğŸ‘¤ ${s.name} (${s.grade})\n`;
    msg += `â€¢ ìˆ™ì œ í‰ê· : ${s.homework || "??"}%\n`;
    msg += `â€¢ í…ŒìŠ¤íŠ¸ í‰ê· : ${s.test || "??"}ì \n`;
    msg += `â€¢ ê²°ì„:${s.att?.absent ?? 0} / ì§€ê°:${s.att?.late ?? 0} / ì¡°í‡´:${s.att?.earlyLeave ?? 0}\n\n`;
  });

  alert(msg);
};

loadStudents();
</script>
[
  {
    "id": "leechaehoon",
    "name": "ì´ì±„í›ˆ",
    "grade": "ì¤‘1",
    "homework": "100",
    "test": "95",
    "att": { "absent": 0, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "kimkangin",
    "name": "ê¹€ê°•ì¸",
    "grade": "ì¤‘1",
    "homework": "100",
    "test": "84",
    "att": { "absent": 0, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "jeongjinwoo",
    "name": "ì •ì§„ìš°",
    "grade": "ì¤‘1",
    "homework": "92",
    "test": "88",
    "att": { "absent": 1, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "jeongyoolwon",
    "name": "ì •ìœ¨ì›",
    "grade": "ì¤‘2",
    "homework": "95",
    "test": "81",
    "att": { "absent": 0, "late": 1, "earlyLeave": 0 }
  },
  {
    "id": "baetaerang",
    "name": "ë°°íƒœë‘",
    "grade": "ì¤‘1",
    "homework": "97",
    "test": "93",
    "att": { "absent": 0, "late": 0, "earlyLeave": 1 }
  },
  {
    "id": "cheyujin",
    "name": "ì œìœ ì§„",
    "grade": "ì¤‘2",
    "homework": "88",
    "test": "72",
    "att": { "absent": 2, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "kangguyuon",
    "name": "ê°•ê·œì˜¨",
    "grade": "ì¤‘1",
    "homework": "100",
    "test": "90",
    "att": { "absent": 0, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "kimgayeon",
    "name": "ê¹€ê°€ì—°",
    "grade": "ì¤‘3",
    "homework": "94",
    "test": "86",
    "att": { "absent": 1, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "kimyoonho",
    "name": "ê¹€ìœ¤í˜¸",
    "grade": "ì¤‘1",
    "homework": "100",
    "test": "89",
    "att": { "absent": 0, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "leeyechan",
    "name": "ì´ì˜ˆì°¬",
    "grade": "ì¤‘1",
    "homework": "90",
    "test": "82",
    "att": { "absent": 0, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "limseojin",
    "name": "ì„ì„œì§„",
    "grade": "ì¤‘2",
    "homework": "100",
    "test": "94",
    "att": { "absent": 0, "late": 1, "earlyLeave": 0 }
  },
  {
    "id": "ohsehong",
    "name": "ì˜¤ì„¸í™",
    "grade": "ì¤‘1",
    "homework": "93",
    "test": "88",
    "att": { "absent": 0, "late": 0, "earlyLeave": 0 }
  },
  {
    "id": "songsihou",
    "name": "ì†¡ì‹œí›„",
    "grade": "ì¤‘3",
    "homework": "100",
    "test": "96",
    "att": { "absent": 0, "late": 1, "earlyLeave": 0 }
  }
]
